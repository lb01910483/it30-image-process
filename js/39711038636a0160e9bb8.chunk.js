(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{474:function(e,t,n){var a=n(551);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n(90).default)("06bf501e",a,!1,{})},475:function(e,t,n){var a=n(553);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n(90).default)("4f9b0c8c",a,!1,{})},484:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},550:function(e,t,n){"use strict";var a=n(474);n.n(a).a},551:function(e,t,n){(e.exports=n(89)(!1)).push([e.i,"",""])},552:function(e,t,n){"use strict";var a=n(475);n.n(a).a},553:function(e,t,n){(e.exports=n(89)(!1)).push([e.i,".image_slider[data-v-1bb0a0c2] {\n  margin: 20px 0px 0px;\n}\n",""])},556:function(e,t,n){"use strict";(function(e){var a=n(484),i=n.n(a),r=n(142),s=n(558),o=n(91),l=n(944);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var u=new Worker(e,{});t.a={name:"Video",components:{ImageSlider:s.a},data:function(){return{isPlay:!1,width:0,height:0,fps:0,lastCallTime:0,barrage:null,barrageInput:"",fibResult:0,enableOffscreen:!1,showCanvas:!0,tmpFps:0,tmpCount:0}},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(n,!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(o.c)({sliderValue:function(e){return e.sliderValue}}),{videoStyle:function(){return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px")}}}),methods:{drawCanvas:function(){var e=this,t=1e3/(performance.now()-this.lastCallTime);if(this.fps=t,this.lastCallTime=performance.now(),this.isPlay=!0,this.enableOffscreen)this.capture.grabFrame().then((function(t){u.postMessage({imageBitmap:t,sliderValue:e.sliderValue,type:"process"},[t])})).catch((function(e){}));else{var n=this.$refs.drawCanvas,a=this.$refs.video,i=n.getContext("2d");i.drawImage(a,0,0,this.width,this.height);var s=i.getImageData(0,0,this.width,this.height),o=Object(r.a)(s,this.sliderValue);i.putImageData(o,0,0),this.barrage.draw()}requestAnimationFrame(this.drawCanvas)},addBarrage:function(){this.barrageInput&&(this.enableOffscreen?u.postMessage({data:{text:this.barrageInput},type:"barrage"}):this.barrage.addBarrage({text:this.barrageInput}),this.barrageInput="")},slowMainThread:function(){this.fibResult=0,this.enableWorker?u.postMessage({type:"fib",fibCount:40}):this.fibResult=Object(r.b)(40)},init:function(){var e=window.innerWidth-800,t=(e=e<800?800:e)*(9/16);this.width=e,this.height=t;var n=this.$refs.drawCanvas;if(n.width=this.width,n.height=this.height,this.enableOffscreen){var a=n.transferControlToOffscreen();u.postMessage({offscreen:a,type:"init",width:this.width,height:this.height},[a])}else{var i=n.getContext("2d");this.barrage=new l.a({ctx:i,width:this.width,height:this.height})}}},watch:{enableOffscreen:function(){var e=this;this.showCanvas=!1,this.$nextTick((function(){e.showCanvas=!0,e.$nextTick((function(){e.init(),e.drawCanvas()}))}))}},mounted:function(){var e=this;this.init();var t=this.$refs.video;t.play().then((function(){console.log("play video start");var n=t.captureStream().getVideoTracks()[0];e.capture=new ImageCapture(n),e.drawCanvas()})).catch((function(e){console.log("play video error",e)})),u.onmessage=function(t){e.fibResult=t.data},u.onerror=function(e){console.log("error",e)}}}}).call(this,n(943))},557:function(e,t,n){var a=n(948);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n(90).default)("887e6544",a,!1,{})},558:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image_slider"},[n("Slider",{attrs:{title:"曝光度",min:-100,max:100,value:e.brightness},on:{sliderChange:function(t){return e.sliderChange(t,"brightness")}}}),e._v(" "),n("Slider",{attrs:{title:"對比度",min:-100,max:100,value:e.contrast},on:{sliderChange:function(t){return e.sliderChange(t,"contrast")}}}),e._v(" "),n("Slider",{attrs:{title:"飽和度",min:-100,max:100,value:e.saturation},on:{sliderChange:function(t){return e.sliderChange(t,"saturation")}}}),e._v(" "),n("Slider",{attrs:{title:"細節飽和度",min:-100,max:100,value:e.vibrance},on:{sliderChange:function(t){return e.sliderChange(t,"vibrance")}}}),e._v(" "),n("Slider",{attrs:{title:"暗部",min:-100,max:100,value:e.shadow},on:{sliderChange:function(t){return e.sliderChange(t,"shadow")}}}),e._v(" "),n("Slider",{attrs:{title:"亮部",min:-100,max:100,value:e.hightLight},on:{sliderChange:function(t){return e.sliderChange(t,"hightLight")}}}),e._v(" "),n("Slider",{attrs:{title:"銳利化",min:-100,max:100,value:e.sharpen},on:{sliderChange:function(t){return e.sliderChange(t,"sharpen")}}})],1)};a._withStripped=!0;var i=n(484),r=n.n(i),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"slider"},[n("span",[e._v(e._s(e.title))]),e._v(" "),n("el-slider",{attrs:{value:e.value,min:e.min,max:e.max},on:{input:e.handleChange}})],1)};s._withStripped=!0;var o={name:"Slider",props:{title:{type:String,default:""},max:{type:Number,default:100},min:{type:Number,default:0},value:{type:Number,default:0}},methods:{handleChange:function(e){this.$emit("sliderChange",e)}}},l=(n(550),n(64)),c=Object(l.a)(o,s,[],!1,null,"64355c54",null);c.options.__file="src/components/Slider/index.vue";var u=c.exports,h=n(91);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var f={name:"ImageSlider",components:{Slider:u},computed:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(n,!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Object(h.c)({brightness:function(e){return e.sliderValue.brightness},contrast:function(e){return e.sliderValue.contrast},saturation:function(e){return e.sliderValue.saturation},vibrance:function(e){return e.sliderValue.vibrance},shadow:function(e){return e.sliderValue.shadow},hightLight:function(e){return e.sliderValue.hightLight},sharpen:function(e){return e.sliderValue.sharpen}})),methods:{sliderChange:function(e,t){this.$store.commit("CHANGE_SLIDER_VALUE",{key:t,val:e})}}},p=(n(552),Object(l.a)(f,a,[],!1,null,"1bb0a0c2",null));p.options.__file="src/components/ImageSlider/index.vue";t.a=p.exports},942:function(e,t){e.exports="assets/video.mp4"},943:function(e,t,n){e.exports=n.p+"js/0ee1d718e40b326e60499.chunk.worker.js"},944:function(e,t,n){"use strict";var a=n(945),i=n.n(a),r=n(946),s=n.n(r),o=function(){function e(t){var n=t.ctx,a=t.width,r=t.height;i()(this,e),this.ctx=n,this.width=a,this.height=r,this.data=[]}return s()(e,[{key:"addBarrage",value:function(e){var t={x:this.width,y:this.height*Math.random(),speed:e.speed||10*Math.random()+.5,fontSize:e.fontSize||10*Math.random()+16,color:e.color||"#".concat(((1<<24)*Math.random()|0).toString(16)),text:e.text||"default"};this.data.push(t)}},{key:"draw",value:function(){for(var e=this.data.length-1;e>=0;e-=1){var t=this.data[e];this.ctx.font="".concat(t.fontSize,"px Microsoft JhengHei, PMingLiU, sans-serif");var n=this.ctx.measureText(t.text).width;t.x+n<0?this.data.splice(e,1):(this.ctx.fillStyle=t.color,t.x=t.x-t.speed,this.ctx.fillText(t.text,t.x,t.y))}}}]),e}();t.a=o},945:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},946:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}e.exports=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}},947:function(e,t,n){"use strict";var a=n(557);n.n(a).a},948:function(e,t,n){(e.exports=n(89)(!1)).push([e.i,".video > span[data-v-ead17a18] {\n  width: 230px;\n  max-width: 230px;\n  display: inline-block;\n}\n.video video[data-v-ead17a18] {\n  display: none;\n}\n.video .box[data-v-ead17a18] {\n  margin: 0px 10px;\n}\n.video .image_container[data-v-ead17a18] {\n  margin: 20px 0px 0px;\n  display: flex;\n}\n.video .image_container .image_editor[data-v-ead17a18] {\n    margin: 0px 0px 0px 20px;\n    width: 200px;\n}\n.video .image_container .button[data-v-ead17a18] {\n    width: 100%;\n    margin: 10px 0 0 0;\n}\n",""])},951:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"video"},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.isPlay,expression:"isPlay"}]},[e._v(" Fps : "+e._s(e.fps))]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isPlay,expression:"isPlay"}],staticClass:"button",on:{click:e.slowMainThread}},[e._v("\r\n    變慢\r\n  ")]),e._v(" "),a("el-checkbox",{staticClass:"box",model:{value:e.enableOffscreen,callback:function(t){e.enableOffscreen=t},expression:"enableOffscreen"}},[e._v("\r\n    使用 Offscreen")]),e._v(" "),e.isPlay&&e.fibResult?a("span",[e._v(" Result: "+e._s(e.fibResult))]):e._e(),e._v(" "),a("div",{staticClass:"image_container"},[a("video",{ref:"video",style:e.videoStyle,attrs:{src:n(942),loop:"",muted:"",autoplay:""},domProps:{muted:!0}}),e._v(" "),e.showCanvas?a("div",{staticClass:"canvas_container"},[a("canvas",{ref:"drawCanvas"})]):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isPlay,expression:"isPlay"}],staticClass:"image_editor"},[a("ImageSlider"),e._v(" "),a("el-input",{attrs:{placeholder:"大家刷一波"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addBarrage(t)}},model:{value:e.barrageInput,callback:function(t){e.barrageInput=t},expression:"barrageInput"}}),e._v(" "),a("el-button",{staticClass:"button",on:{click:e.addBarrage}},[e._v("\r\n        送出\r\n      ")])],1)])],1)};a._withStripped=!0;var i=n(556).a,r=(n(947),n(64)),s=Object(r.a)(i,a,[],!1,null,"ead17a18",null);s.options.__file="src/views/Video/index.vue";t.default=s.exports}}]);